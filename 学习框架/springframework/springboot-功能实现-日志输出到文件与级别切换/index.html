<!DOCTYPE html>
<html lang="zh">
    <head>
        
        


<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="chrome=1">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer">
<meta name="description" content="站点描述">
<title>
Spring Boot 功能实现 日志操作 - 博客
</title>



        
        <meta property="og:title" content="SpringBoot-功能实现-日志操作 - 博客" />
<meta property="og:type" content="website" />
<meta property="og:description" content="SpringBoot-功能实现-日志操作"/>
<meta property="og:url" content="https://huangruiying.github.io/%E5%AD%A6%E4%B9%A0%E6%A1%86%E6%9E%B6/springframework/springboot-%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0-%E6%97%A5%E5%BF%97%E8%BE%93%E5%87%BA%E5%88%B0%E6%96%87%E4%BB%B6%E4%B8%8E%E7%BA%A7%E5%88%AB%E5%88%87%E6%8D%A2/"/>
<meta property="og:site_name" content="博客"/>




<meta property="og:image" content="https://huangruiying.github.io/home/profile.jpg"/>




        
<link rel="shortcut icon" href="/img/fav.ico">


        





<link rel="stylesheet" href="/css/main.min.dd3261b90e17cd2e5208587affc019817808ed59c99ecc51d4593170ce72c29d.css" integrity="sha256-3TJhuQ4XzS5SCFh6/8AZgXgI7VnJnsxR1FkxcM5ywp0=" crossorigin="anonymous" media="screen">





        
        
        
        
    </head>
    <body>
        <section id="top" class="section">
            
            <div class="container hero  fade-in one ">
                
                <h1 class="bold-title is-1">SpringBoot-功能实现-日志操作</h1>
                
            </div>
            
            <div class="section  fade-in two ">
                

<div class="container">
    <hr>
    <nav class="navbar" role="navigation" aria-label="main navigation">
        
        <a role="button" class="navbar-burger" data-target="navMenu" aria-label="menu" aria-expanded="false" >
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
        </a>
        <div class="navbar-menu " id="navMenu">
            
            
            
            
            <a class="navbar-item" href="/blog/">
                
                博客
                
            </a>
            
            
            
            <a class="navbar-item" href="/tags/">
                
                标签
                
            </a>
            
            
            
            <a class="navbar-item" href="/categories/">
                
                类目
                
            </a>
            
            
            
            <a class="navbar-item" href="/">
                
                主页
                
            </a>
            
            
            
        </div>
    </nav>
    <hr>
</div>




                
    <div class="container markdown top-pad">
        
<h1 id="自定义日志文件输出手动生成日志--打入指定日志文件" class="anchor-link"><a href="#%e8%87%aa%e5%ae%9a%e4%b9%89%e6%97%a5%e5%bf%97%e6%96%87%e4%bb%b6%e8%be%93%e5%87%ba%e6%89%8b%e5%8a%a8%e7%94%9f%e6%88%90%e6%97%a5%e5%bf%97--%e6%89%93%e5%85%a5%e6%8c%87%e5%ae%9a%e6%97%a5%e5%bf%97%e6%96%87%e4%bb%b6">自定义日志文件输出：手动生成日志 &amp; 打入指定日志文件</a></h1>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#586e75">&lt;!-- 定义日志对象及信息 --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">&lt;configuration&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#586e75">&lt;!-- 定义「指定」日志文件配置 --&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">&lt;appender</span> name=<span style="color:#2aa198">&#34;httpConsumer&#34;</span> class=<span style="color:#2aa198">&#34;ch.qos.logback.core.rolling.RollingFileAppender&#34;</span><span style="color:#268bd2">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#268bd2">&lt;file&gt;</span>${LOG_FILE}/consumer.log<span style="color:#268bd2">&lt;/file&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#268bd2">&lt;encoder&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#268bd2">&lt;pattern&gt;</span>%msg%n<span style="color:#268bd2">&lt;/pattern&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#268bd2">&lt;immediateFlush&gt;</span>true<span style="color:#268bd2">&lt;/immediateFlush&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#268bd2">&lt;charset&gt;</span>UTF-8<span style="color:#268bd2">&lt;/charset&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#268bd2">&lt;/encoder&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#268bd2">&lt;rollingPolicy</span> class=<span style="color:#2aa198">&#34;ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy&#34;</span><span style="color:#268bd2">&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#268bd2">&lt;fileNamePattern&gt;</span>${LOG_FILE}/consumer-%d{yyyy-MM-dd-HH}-%i.log<span style="color:#268bd2">&lt;/fileNamePattern&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#268bd2">&lt;maxFileSize&gt;</span>300MB<span style="color:#268bd2">&lt;/maxFileSize&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#268bd2">&lt;maxHistory&gt;</span>240<span style="color:#268bd2">&lt;/maxHistory&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#268bd2">&lt;CleanHistoryOnStart&gt;</span>true<span style="color:#268bd2">&lt;/CleanHistoryOnStart&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#268bd2">&lt;totalSizeCap&gt;</span>60GB<span style="color:#268bd2">&lt;/totalSizeCap&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#268bd2">&lt;/rollingPolicy&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">&lt;/appender&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#586e75">&lt;!-- 定义日志对象及信息 --&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">&lt;appender</span> name=<span style="color:#2aa198">&#34;asyncHttpConsumer&#34;</span> class=<span style="color:#2aa198">&#34;ch.qos.logback.classic.AsyncAppender&#34;</span><span style="color:#268bd2">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#268bd2">&lt;appender-ref</span> ref=<span style="color:#2aa198">&#34;httpConsumer&#34;</span><span style="color:#268bd2">/&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#268bd2">&lt;queueSize&gt;</span>1024<span style="color:#268bd2">&lt;/queueSize&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#268bd2">&lt;neverBlock&gt;</span>true<span style="color:#268bd2">&lt;/neverBlock&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">&lt;/appender&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#586e75">&lt;!-- 创建日志对象，java代码里面通过name获取日志句柄 --&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">&lt;logger</span> name=<span style="color:#2aa198">&#34;http_consumer_log&#34;</span> additivity=<span style="color:#2aa198">&#34;false&#34;</span><span style="color:#268bd2">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#268bd2">&lt;appender-ref</span> ref=<span style="color:#2aa198">&#34;asyncHttpConsumer&#34;</span><span style="color:#268bd2">/&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">&lt;/logger&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">&lt;/configuration&gt;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#586e75">/**
</span></span></span><span style="display:flex;"><span><span style="color:#586e75"> * 输出自定义日志到指定日志文件 &lt;br/&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#586e75"> * 例如：http_consumer_log
</span></span></span><span style="display:flex;"><span><span style="color:#586e75"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">public</span> <span style="color:#268bd2">class</span> <span style="color:#268bd2">Loggers</span> <span style="color:#719e07">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#268bd2">public</span> <span style="color:#268bd2">static</span> <span style="color:#dc322f">void</span> <span style="color:#268bd2">main</span><span style="color:#719e07">(</span>String<span style="color:#719e07">[]</span> args<span style="color:#719e07">)</span> <span style="color:#719e07">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#586e75">// 获取日志对象，并向其输出日志信息
</span></span></span><span style="display:flex;"><span><span style="color:#586e75"></span>		Loggers<span style="color:#719e07">.</span>getHttpConsumerLogger<span style="color:#719e07">().</span>info<span style="color:#719e07">(</span>JSONObject<span style="color:#719e07">.</span>toJSONString<span style="color:#719e07">(</span>logMap<span style="color:#719e07">));</span>
</span></span><span style="display:flex;"><span>	<span style="color:#719e07">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#586e75">/**
</span></span></span><span style="display:flex;"><span><span style="color:#586e75">	 * 我方调用外部服务的日志
</span></span></span><span style="display:flex;"><span><span style="color:#586e75">	 */</span>
</span></span><span style="display:flex;"><span>	<span style="color:#268bd2">private</span> <span style="color:#268bd2">static</span> <span style="color:#268bd2">final</span> Logger HTTP_CONSUMER_LOGGER <span style="color:#719e07">=</span> LoggerFactory<span style="color:#719e07">.</span>getLogger<span style="color:#719e07">(</span><span style="color:#2aa198">&#34;http_consumer_log&#34;</span><span style="color:#719e07">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#268bd2">public</span> <span style="color:#268bd2">static</span> Logger <span style="color:#268bd2">getHttpConsumerLogger</span><span style="color:#719e07">()</span> <span style="color:#719e07">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#719e07">return</span> HTTP_CONSUMER_LOGGER<span style="color:#719e07">;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#719e07">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#586e75">/**
</span></span></span><span style="display:flex;"><span><span style="color:#586e75">	 * 外部调用我方接口的日志
</span></span></span><span style="display:flex;"><span><span style="color:#586e75">	 */</span>
</span></span><span style="display:flex;"><span>	<span style="color:#268bd2">private</span> <span style="color:#268bd2">static</span> <span style="color:#268bd2">final</span> Logger HTTP_PROVIDER_LOGGER <span style="color:#719e07">=</span> LoggerFactory<span style="color:#719e07">.</span>getLogger<span style="color:#719e07">(</span><span style="color:#2aa198">&#34;http_provider_log&#34;</span><span style="color:#719e07">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#268bd2">public</span> <span style="color:#268bd2">static</span> Logger <span style="color:#268bd2">getHttpProviderLogger</span><span style="color:#719e07">()</span> <span style="color:#719e07">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#719e07">return</span> HTTP_PROVIDER_LOGGER<span style="color:#719e07">;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#719e07">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#586e75">/**
</span></span></span><span style="display:flex;"><span><span style="color:#586e75">	 * 数据库日志
</span></span></span><span style="display:flex;"><span><span style="color:#586e75">	 */</span>
</span></span><span style="display:flex;"><span>	<span style="color:#268bd2">private</span> <span style="color:#268bd2">static</span> <span style="color:#268bd2">final</span> Logger DB_ACCESS_LOGGER <span style="color:#719e07">=</span> LoggerFactory<span style="color:#719e07">.</span>getLogger<span style="color:#719e07">(</span><span style="color:#2aa198">&#34;db_access_log&#34;</span><span style="color:#719e07">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#268bd2">public</span> <span style="color:#268bd2">static</span> Logger <span style="color:#268bd2">getDbAccessLogger</span><span style="color:#719e07">()</span> <span style="color:#719e07">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#719e07">return</span> DB_ACCESS_LOGGER<span style="color:#719e07">;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#719e07">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#719e07">}</span>
</span></span></code></pre></div>
<h1 id="日志种类与实现consumer-provider-info-error-dbaccess" class="anchor-link"><a href="#%e6%97%a5%e5%bf%97%e7%a7%8d%e7%b1%bb%e4%b8%8e%e5%ae%9e%e7%8e%b0consumer-provider-info-error-dbaccess">日志种类与实现：consumer provider info error dbaccess</a></h1>

<h3 id="consumer---feign" class="anchor-link"><a href="#consumer---feign">consumer - feign</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#586e75">// consumer - extends feign.Logger.NoOpLogger
</span></span></span><span style="display:flex;"><span><span style="color:#586e75"></span><span style="color:#268bd2">class</span> <span style="color:#268bd2">FeignRequestLogger</span> <span style="color:#268bd2">extends</span> feign<span style="color:#719e07">.</span>Logger<span style="color:#719e07">.</span>NoOpLogger <span style="color:#719e07">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#586e75">// 存储请求
</span></span></span><span style="display:flex;"><span><span style="color:#586e75"></span>	<span style="color:#268bd2">@Override</span>
</span></span><span style="display:flex;"><span>	<span style="color:#268bd2">protected</span> <span style="color:#dc322f">void</span> <span style="color:#268bd2">logRequest</span><span style="color:#719e07">(</span>String configKey<span style="color:#719e07">,</span> Logger<span style="color:#719e07">.</span>Level logLevel<span style="color:#719e07">,</span> Request request<span style="color:#719e07">)</span> <span style="color:#719e07">{</span>
</span></span><span style="display:flex;"><span>		requestThreadLocal<span style="color:#719e07">.</span>set<span style="color:#719e07">(</span>request<span style="color:#719e07">);</span>
</span></span><span style="display:flex;"><span>	<span style="color:#719e07">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#586e75">// 正常日志
</span></span></span><span style="display:flex;"><span><span style="color:#586e75"></span>	<span style="color:#268bd2">@Override</span>
</span></span><span style="display:flex;"><span>	<span style="color:#268bd2">protected</span> Response <span style="color:#268bd2">logAndRebufferResponse</span><span style="color:#719e07">(</span>String configKey<span style="color:#719e07">,</span> Logger<span style="color:#719e07">.</span>Level logLevel<span style="color:#719e07">,</span> Response response<span style="color:#719e07">,</span> <span style="color:#dc322f">long</span> elapsedTime<span style="color:#719e07">)</span> <span style="color:#268bd2">throws</span> IOException <span style="color:#719e07">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#719e07">try</span> <span style="color:#719e07">{</span>
</span></span><span style="display:flex;"><span>			Request request <span style="color:#719e07">=</span> requestThreadLocal<span style="color:#719e07">.</span>get<span style="color:#719e07">();</span>
</span></span><span style="display:flex;"><span>			<span style="color:#719e07">if</span> <span style="color:#719e07">(</span>request <span style="color:#719e07">!=</span> <span style="color:#cb4b16">null</span><span style="color:#719e07">)</span> <span style="color:#719e07">{</span>
</span></span><span style="display:flex;"><span>				<span style="color:#719e07">return</span> log<span style="color:#719e07">(</span>logLevel<span style="color:#719e07">,</span> configKey<span style="color:#719e07">,</span> request<span style="color:#719e07">,</span> response<span style="color:#719e07">,</span> <span style="color:#cb4b16">null</span><span style="color:#719e07">,</span> elapsedTime<span style="color:#719e07">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#719e07">}</span>
</span></span><span style="display:flex;"><span>			<span style="color:#719e07">return</span> response<span style="color:#719e07">;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#719e07">}</span> <span style="color:#719e07">finally</span> <span style="color:#719e07">{</span>
</span></span><span style="display:flex;"><span>			requestThreadLocal<span style="color:#719e07">.</span>remove<span style="color:#719e07">();</span>
</span></span><span style="display:flex;"><span>		<span style="color:#719e07">}</span>
</span></span><span style="display:flex;"><span>	<span style="color:#719e07">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#586e75">// 异常日志
</span></span></span><span style="display:flex;"><span><span style="color:#586e75"></span>	<span style="color:#268bd2">@Override</span>
</span></span><span style="display:flex;"><span>	<span style="color:#268bd2">public</span> IOException <span style="color:#268bd2">logIOException</span><span style="color:#719e07">(</span>String configKey<span style="color:#719e07">,</span> Logger<span style="color:#719e07">.</span>Level logLevel<span style="color:#719e07">,</span> IOException ioe<span style="color:#719e07">,</span> <span style="color:#dc322f">long</span> elapsedTime<span style="color:#719e07">)</span> <span style="color:#719e07">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#719e07">try</span> <span style="color:#719e07">{</span>
</span></span><span style="display:flex;"><span>			Request request <span style="color:#719e07">=</span> requestThreadLocal<span style="color:#719e07">.</span>get<span style="color:#719e07">();</span>
</span></span><span style="display:flex;"><span>			<span style="color:#719e07">if</span> <span style="color:#719e07">(</span>request <span style="color:#719e07">!=</span> <span style="color:#cb4b16">null</span><span style="color:#719e07">)</span> <span style="color:#719e07">{</span>
</span></span><span style="display:flex;"><span>				log<span style="color:#719e07">(</span>logLevel<span style="color:#719e07">,</span> configKey<span style="color:#719e07">,</span> request<span style="color:#719e07">,</span> <span style="color:#cb4b16">null</span><span style="color:#719e07">,</span> ioe<span style="color:#719e07">,</span> elapsedTime<span style="color:#719e07">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#719e07">}</span>
</span></span><span style="display:flex;"><span>			<span style="color:#719e07">return</span> ioe<span style="color:#719e07">;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#719e07">}</span> <span style="color:#719e07">finally</span> <span style="color:#719e07">{</span>
</span></span><span style="display:flex;"><span>			requestThreadLocal<span style="color:#719e07">.</span>remove<span style="color:#719e07">();</span>
</span></span><span style="display:flex;"><span>		<span style="color:#719e07">}</span>
</span></span><span style="display:flex;"><span>	<span style="color:#719e07">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#586e75">// 实际输出日志到log文件。
</span></span></span><span style="display:flex;"><span><span style="color:#586e75"></span>	<span style="color:#268bd2">private</span> Response <span style="color:#268bd2">output</span><span style="color:#719e07">(</span>Logger<span style="color:#719e07">.</span>Level logLevel<span style="color:#719e07">,</span> String configKey<span style="color:#719e07">,</span> Request request<span style="color:#719e07">,</span> Response response<span style="color:#719e07">,</span> IOException ioe<span style="color:#719e07">,</span> <span style="color:#dc322f">long</span> waste<span style="color:#719e07">)</span> <span style="color:#719e07">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#719e07">try</span> <span style="color:#719e07">{</span>
</span></span><span style="display:flex;"><span>			Map<span style="color:#719e07">&lt;</span>String<span style="color:#719e07">,</span> Object<span style="color:#719e07">&gt;</span> logMap <span style="color:#719e07">=</span> Maps<span style="color:#719e07">.</span>newLinkedHashMap<span style="color:#719e07">();</span>
</span></span><span style="display:flex;"><span>			logMap<span style="color:#719e07">.</span>put<span style="color:#719e07">(</span><span style="color:#2aa198">&#34;service&#34;</span><span style="color:#719e07">,</span> <span style="color:#2aa198">&#34;服务名称&#34;</span><span style="color:#719e07">);</span>
</span></span><span style="display:flex;"><span>			logMap<span style="color:#719e07">.</span>put<span style="color:#719e07">(</span><span style="color:#2aa198">&#34;handlerMethod&#34;</span><span style="color:#719e07">,</span> configKey<span style="color:#719e07">);</span>
</span></span><span style="display:flex;"><span>			logMap<span style="color:#719e07">.</span>put<span style="color:#719e07">(</span><span style="color:#2aa198">&#34;uri&#34;</span><span style="color:#719e07">,</span> <span style="color:#2aa198">&#34;uri&#34;</span><span style="color:#719e07">);</span>
</span></span><span style="display:flex;"><span>			logMap<span style="color:#719e07">.</span>put<span style="color:#719e07">(</span><span style="color:#2aa198">&#34;desservice&#34;</span><span style="color:#719e07">,</span> <span style="color:#2aa198">&#34;设备信息&#34;</span><span style="color:#719e07">);</span>
</span></span><span style="display:flex;"><span>			logMap<span style="color:#719e07">.</span>put<span style="color:#719e07">(</span><span style="color:#2aa198">&#34;targetIp&#34;</span><span style="color:#719e07">,</span> <span style="color:#2aa198">&#34;目标服务ip&#34;</span><span style="color:#719e07">);</span>
</span></span><span style="display:flex;"><span>			logMap<span style="color:#719e07">.</span>put<span style="color:#719e07">(</span><span style="color:#2aa198">&#34;params&#34;</span><span style="color:#719e07">,</span> <span style="color:#2aa198">&#34;请求目标服务参数&#34;</span><span style="color:#719e07">);</span>
</span></span><span style="display:flex;"><span>			logMap<span style="color:#719e07">.</span>put<span style="color:#719e07">(</span><span style="color:#2aa198">&#34;method&#34;</span><span style="color:#719e07">,</span> <span style="color:#2aa198">&#34;method&#34;</span><span style="color:#719e07">);</span>
</span></span><span style="display:flex;"><span>			logMap<span style="color:#719e07">.</span>put<span style="color:#719e07">(</span><span style="color:#2aa198">&#34;request&#34;</span><span style="color:#719e07">,</span> <span style="color:#2aa198">&#34;请求信息&#34;</span><span style="color:#719e07">);</span>
</span></span><span style="display:flex;"><span>			logMap<span style="color:#719e07">.</span>put<span style="color:#719e07">(</span><span style="color:#2aa198">&#34;status&#34;</span><span style="color:#719e07">,</span> <span style="color:#2aa198">&#34;status&#34;</span><span style="color:#719e07">);</span>
</span></span><span style="display:flex;"><span>			logMap<span style="color:#719e07">.</span>put<span style="color:#719e07">(</span><span style="color:#2aa198">&#34;thread&#34;</span><span style="color:#719e07">,</span> Thread<span style="color:#719e07">.</span>currentThread<span style="color:#719e07">().</span>getName<span style="color:#719e07">());</span>
</span></span><span style="display:flex;"><span>			logMap<span style="color:#719e07">.</span>put<span style="color:#719e07">(</span><span style="color:#2aa198">&#34;serverTime&#34;</span><span style="color:#719e07">,</span> DateFormatUtils<span style="color:#719e07">.</span>format<span style="color:#719e07">(</span><span style="color:#719e07">new</span> Date<span style="color:#719e07">(),</span> <span style="color:#2aa198">&#34;yyyy-MM-dd HH:mm:ss.SSS&#34;</span><span style="color:#719e07">));</span>
</span></span><span style="display:flex;"><span>			logMap<span style="color:#719e07">.</span>put<span style="color:#719e07">(</span><span style="color:#2aa198">&#34;trace_id&#34;</span><span style="color:#719e07">,</span> <span style="color:#2aa198">&#34;trace_id&#34;</span><span style="color:#719e07">);</span>
</span></span><span style="display:flex;"><span>			logMap<span style="color:#719e07">.</span>put<span style="color:#719e07">(</span><span style="color:#2aa198">&#34;waste&#34;</span><span style="color:#719e07">,</span> waste<span style="color:#719e07">);</span>
</span></span><span style="display:flex;"><span>			logMap<span style="color:#719e07">.</span>put<span style="color:#719e07">(</span><span style="color:#2aa198">&#34;response&#34;</span><span style="color:#719e07">,</span> <span style="color:#2aa198">&#34;服务响应信息&#34;</span><span style="color:#719e07">);</span>
</span></span><span style="display:flex;"><span>			logMap<span style="color:#719e07">.</span>put<span style="color:#719e07">(</span><span style="color:#2aa198">&#34;consumerSlowQuery&#34;</span><span style="color:#719e07">,</span> <span style="color:#2aa198">&#34;costGe 耗时信息 ms&#34;</span><span style="color:#719e07">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>			Exception ex <span style="color:#719e07">=</span> ioe<span style="color:#719e07">;</span>
</span></span><span style="display:flex;"><span>			<span style="color:#719e07">if</span> <span style="color:#719e07">(</span>ex <span style="color:#719e07">==</span> <span style="color:#cb4b16">null</span> <span style="color:#719e07">&amp;&amp;</span> response <span style="color:#719e07">!=</span> <span style="color:#cb4b16">null</span> <span style="color:#719e07">&amp;&amp;</span> httpcode <span style="color:#719e07">!=</span> <span style="color:#2aa198">200</span><span style="color:#719e07">)</span> <span style="color:#719e07">{</span>
</span></span><span style="display:flex;"><span>				ex <span style="color:#719e07">=</span> <span style="color:#719e07">new</span> IllegalStateException<span style="color:#719e07">(</span><span style="color:#2aa198">&#34;response status is &#34;</span> <span style="color:#719e07">+</span> response<span style="color:#719e07">.</span>status<span style="color:#719e07">());</span>
</span></span><span style="display:flex;"><span>			<span style="color:#719e07">}</span>
</span></span><span style="display:flex;"><span>			<span style="color:#719e07">if</span> <span style="color:#719e07">(</span>ex <span style="color:#719e07">!=</span> <span style="color:#cb4b16">null</span><span style="color:#719e07">)</span> <span style="color:#719e07">{</span>
</span></span><span style="display:flex;"><span>				<span style="color:#586e75">// 错误日志
</span></span></span><span style="display:flex;"><span><span style="color:#586e75"></span>				logMap<span style="color:#719e07">.</span>put<span style="color:#719e07">(</span><span style="color:#2aa198">&#34;log_level&#34;</span><span style="color:#719e07">,</span> <span style="color:#2aa198">&#34;ERROR&#34;</span><span style="color:#719e07">);</span>
</span></span><span style="display:flex;"><span>				Loggers<span style="color:#719e07">.</span>getHttpConsumerLogger<span style="color:#719e07">().</span>error<span style="color:#719e07">(</span>JSONObject<span style="color:#719e07">.</span>toJSONString<span style="color:#719e07">(</span>logMap<span style="color:#719e07">),</span> ex<span style="color:#719e07">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#719e07">}</span> <span style="color:#719e07">else</span> <span style="color:#719e07">{</span>
</span></span><span style="display:flex;"><span>				<span style="color:#586e75">// 正常日志
</span></span></span><span style="display:flex;"><span><span style="color:#586e75"></span>				logMap<span style="color:#719e07">.</span>put<span style="color:#719e07">(</span><span style="color:#2aa198">&#34;log_level&#34;</span><span style="color:#719e07">,</span> <span style="color:#2aa198">&#34;INFO&#34;</span><span style="color:#719e07">);</span>
</span></span><span style="display:flex;"><span>				Loggers<span style="color:#719e07">.</span>getHttpConsumerLogger<span style="color:#719e07">().</span>info<span style="color:#719e07">(</span>JSONObject<span style="color:#719e07">.</span>toJSONString<span style="color:#719e07">(</span>logMap<span style="color:#719e07">));</span>
</span></span><span style="display:flex;"><span>			<span style="color:#719e07">}</span>
</span></span><span style="display:flex;"><span>		<span style="color:#719e07">}</span> <span style="color:#719e07">catch</span> <span style="color:#719e07">(</span>Exception ex<span style="color:#719e07">)</span> <span style="color:#719e07">{</span>
</span></span><span style="display:flex;"><span>			log<span style="color:#719e07">.</span>error<span style="color:#719e07">(</span><span style="color:#2aa198">&#34;log error&#34;</span><span style="color:#719e07">,</span> ex<span style="color:#719e07">);</span>
</span></span><span style="display:flex;"><span>		<span style="color:#719e07">}</span>
</span></span><span style="display:flex;"><span>		<span style="color:#719e07">return</span> response<span style="color:#719e07">;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#719e07">}</span>
</span></span><span style="display:flex;"><span><span style="color:#719e07">}</span>
</span></span></code></pre></div>
<h3 id="consumer---http" class="anchor-link"><a href="#consumer---http">consumer - http</a></h3>

<h3 id="provider---feign" class="anchor-link"><a href="#provider---feign">provider - feign/</a></h3>

<h3 id="info-使用logback配置即可" class="anchor-link"><a href="#info-%e4%bd%bf%e7%94%a8logback%e9%85%8d%e7%bd%ae%e5%8d%b3%e5%8f%af">info 使用logback配置即可</a></h3>

<h3 id="error-使用logback配置即可" class="anchor-link"><a href="#error-%e4%bd%bf%e7%94%a8logback%e9%85%8d%e7%bd%ae%e5%8d%b3%e5%8f%af">error 使用logback配置即可</a></h3>

<h1 id="依赖包" class="anchor-link"><a href="#%e4%be%9d%e8%b5%96%e5%8c%85">依赖包</a></h1>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#268bd2">&lt;dependencies&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#268bd2">&lt;groupId&gt;</span>org.slf4j<span style="color:#268bd2">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#268bd2">&lt;artifactId&gt;</span>slf4j-api<span style="color:#268bd2">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#268bd2">&lt;version&gt;</span>1.7.7<span style="color:#268bd2">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#268bd2">&lt;groupId&gt;</span>ch.qos.logback<span style="color:#268bd2">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#268bd2">&lt;artifactId&gt;</span>logback-core<span style="color:#268bd2">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#268bd2">&lt;version&gt;</span>1.2.3<span style="color:#268bd2">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#268bd2">&lt;groupId&gt;</span>ch.qos.logback<span style="color:#268bd2">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#268bd2">&lt;artifactId&gt;</span>logback-access<span style="color:#268bd2">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#268bd2">&lt;version&gt;</span>1.2.3<span style="color:#268bd2">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#268bd2">&lt;groupId&gt;</span>ch.qos.logback<span style="color:#268bd2">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#268bd2">&lt;artifactId&gt;</span>logback-classic<span style="color:#268bd2">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#268bd2">&lt;version&gt;</span>1.2.3<span style="color:#268bd2">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">&lt;/dependencies&gt;</span>
</span></span></code></pre></div>
    </div>
    
    



                
                <div class="container">
    <hr>
</div>
<div class="container has-text-centered top-pad">
    <a href="#top">
        <i class="fa fa-arrow-up"></i>
    </a>
</div>

<div class="container">
    <hr>
</div>

                <div class="section" id="footer">
    <div class="container has-text-centered">
    
        <span class="footer-text">
            
        </span>
    
    </div>
</div>

                
            </div>
        </section>
        
        


<script src="https://huangruiying.github.io/js/bundle.5c23c0437f001a469ca373a465a6f7487203d18e10cdff76d86a60af66d5ee28.js" integrity="sha256-XCPAQ38AGkaco3OkZab3SHID0Y4Qzf922Gpgr2bV7ig="></script>




        
        
        
        
    </body>
</html>

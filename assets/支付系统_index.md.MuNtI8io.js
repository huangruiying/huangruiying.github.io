import{_ as i,c as a,o as n,a1 as h}from"./chunks/framework.CPsxJxQM.js";const E=JSON.parse('{"title":"支付系统的部分基础知识与设计","description":"","frontmatter":{},"headers":[],"relativePath":"支付系统/index.md","filePath":"支付系统/index.md"}'),k={name:"支付系统/index.md"};function t(p,s,l,F,e,d){return n(),a("div",null,s[0]||(s[0]=[h('<h1 id="支付系统的部分基础知识与设计" tabindex="-1">支付系统的部分基础知识与设计 <a class="header-anchor" href="#支付系统的部分基础知识与设计" aria-label="Permalink to &quot;支付系统的部分基础知识与设计&quot;">​</a></h1><p>讲述对接不同的业务渠道支付玩法、支付系统可靠性保障等</p><h2 id="支付通道" tabindex="-1">支付通道 <a class="header-anchor" href="#支付通道" aria-label="Permalink to &quot;支付通道&quot;">​</a></h2><blockquote><p>用于与央行交互，转移交易双方资金的载体</p></blockquote><p>微信、支付宝、云闪付、易宝、汇付、通联、招商银行</p><h2 id="支付方式" tabindex="-1">支付方式 <a class="header-anchor" href="#支付方式" aria-label="Permalink to &quot;支付方式&quot;">​</a></h2><blockquote><p>卡基支付 + 账基支付</p></blockquote><p>储蓄卡、信用卡、支付宝、微信、云闪付</p><h2 id="支付产品" tabindex="-1">支付产品 <a class="header-anchor" href="#支付产品" aria-label="Permalink to &quot;支付产品&quot;">​</a></h2><blockquote><p>APP、小程序、掌纹、主扫、被扫、商户代扣、协议快捷支付、周期扣款 ...</p></blockquote><h2 id="支付表核心字段" tabindex="-1">支付表核心字段 <a class="header-anchor" href="#支付表核心字段" aria-label="Permalink to &quot;支付表核心字段&quot;">​</a></h2><h3 id="业务请求单-biz-order" tabindex="-1">业务请求单 biz_order <a class="header-anchor" href="#业务请求单-biz-order" aria-label="Permalink to &quot;业务请求单 biz_order&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">CREATE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> TABLE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">biz_order</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> BIGINT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> UNSIGNED</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> NOT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> NULL</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> AUTO_INCREMENT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> COMMENT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;主键ID&#39;,</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">biz_order_no</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> VARCHAR(64</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NOT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> NULL</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> COMMENT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;业务方订单号，幂等键&#39;,</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">biz_line</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> VARCHAR(64</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) NOT NULL COMMENT </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;业务线标识&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">biz_identity</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> VARCHAR(64</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) DEFAULT NULL COMMENT </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;业务标识&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">user_id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> VARCHAR(64</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) NOT NULL COMMENT </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;内部用户ID&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">total_amount</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> BIGINT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> NOT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> NULL</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> COMMENT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;订单总金额（分）&#39;,</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">currency</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> VARCHAR(16</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) DEFAULT </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;CNY&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> COMMENT </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;币种&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">order_status</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> VARCHAR(32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) DEFAULT </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;INIT&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> COMMENT </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;业务订单状态（INIT、PROCESSING、SUCCESS、CLOSED 等）&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">notify_url</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> VARCHAR(255</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) DEFAULT NULL COMMENT </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;业务方通知地址&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sign_url</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> VARCHAR(255</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) DEFAULT NULL COMMENT </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;签约结果通知地址&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">return_url</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> VARCHAR(255</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) DEFAULT NULL COMMENT </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;页面跳转地址&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">created_at</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> DATETIME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEFAULT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> CURRENT_TIMESTAMP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> COMMENT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;创建时间&#39;,</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">updated_at</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> DATETIME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEFAULT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> CURRENT_TIMESTAMP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ON</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> UPDATE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> CURRENT_TIMESTAMP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> COMMENT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;更新时间&#39;,</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    PRIMARY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> KEY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    UNIQUE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> KEY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">uniq_biz_order_no</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">biz_order_no</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">,</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    INDEX</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">idx_user_id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">user_id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT=&#39;业务收单单表（业务方发起的支付请求）&#39;;</span></span></code></pre></div><h3 id="支付核心单-pay-order" tabindex="-1">支付核心单 pay_order <a class="header-anchor" href="#支付核心单-pay-order" aria-label="Permalink to &quot;支付核心单 pay_order&quot;">​</a></h3><table tabindex="0"><thead><tr><th>字段分类</th><th>字段名</th><th>说明</th></tr></thead><tbody><tr><td>订单标识</td><td>pay_order_no</td><td>支付核心单号（支付内部生成）</td></tr><tr><td></td><td>biz_order_no</td><td>业务方单号（接入业务方的核心单号，一个业务方单号对多个支付核心单号）</td></tr><tr><td></td><td>channel_order_no</td><td>支付通道单号（第三方支付平台生成）</td></tr><tr><td>商户信息</td><td>mch_no</td><td>商户号（支付通道的商户号）</td></tr><tr><td></td><td>isv_no</td><td>服务商号</td></tr><tr><td></td><td>mch_type</td><td>商户类型：1-普通商户，2-特约商户（服务商模式）</td></tr><tr><td>金额相关</td><td>pay_amount</td><td>支付金额（单位：分）</td></tr><tr><td></td><td>refund_amount</td><td>累计退款总金额（单位：分）</td></tr><tr><td></td><td>platform_subsidy</td><td>自由平台补贴（单位：分）</td></tr><tr><td></td><td>biz_subsidy</td><td>业务方补贴（单位：分）</td></tr><tr><td></td><td>channel_subsidy</td><td>支付通道补贴（单位：分）</td></tr><tr><td></td><td>bank_subsidy</td><td>银行补贴（单位：分）</td></tr><tr><td>支付状态</td><td>pay_status</td><td>支付状态：待支付、支付成功、超时关单、主动关单等</td></tr><tr><td></td><td>refund_status</td><td>退款状态：0-未退款，1-部分退款，2-全额退款</td></tr><tr><td></td><td>refund_times</td><td>退款次数</td></tr><tr><td></td><td>callback_status</td><td>向下游回调状态：0-未发送，1-已发送</td></tr><tr><td>请求与结果</td><td>request_data</td><td>请求参数（支付服务下单时的原始参数 JSON）</td></tr><tr><td></td><td>result_data</td><td>支付结果（通道/渠道回调、查询等 JSON）</td></tr><tr><td>支付方式与产品</td><td>pay_type</td><td>支付方式（卡基：储蓄卡、信用卡；账基：支付宝、微信、云闪付），收银台列表展示的是这些支付方式</td></tr><tr><td></td><td>trade_type</td><td>支付产品：App支付、H5支付、小程序、扫码、付款码、信用付、代扣、周期支付</td></tr><tr><td></td><td>receipt_channel</td><td>收单通道：京东、易宝、微信、云闪付、招商银行等</td></tr><tr><td></td><td></td><td>示例：使用易宝间连微信 → 易宝是收单通道，微信是支付方式</td></tr><tr><td>业务信息</td><td>biz_line</td><td>业务线标识</td></tr><tr><td></td><td>biz_identity</td><td>业务标识</td></tr><tr><td>通知地址</td><td>notify_url</td><td>业务结果通知地址（如 <a href="http://xxxxxws" target="_blank" rel="noreferrer">http://xxxxxws</a>）</td></tr><tr><td></td><td>return_url</td><td>页面跳转地址（如 <a href="http://xxxxxws" target="_blank" rel="noreferrer">http://xxxxxws</a>）</td></tr><tr><td></td><td>sign_notify_url</td><td>签约结果通知地址（用于支付即签约场景）</td></tr><tr><td>用户信息</td><td>user_id</td><td>内部用户 ID</td></tr><tr><td></td><td>third_identity_id</td><td>支付通道用户标识（如 openid、uid）</td></tr><tr><td></td><td>client_ip</td><td>客户端 IP</td></tr></tbody></table><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">CREATE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> TABLE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pay_order</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> BIGINT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> UNSIGNED</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> NOT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> NULL</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> AUTO_INCREMENT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> COMMENT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;主键ID&#39;,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    --</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 订单标识</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pay_order_no</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> VARCHAR(64</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NOT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> NULL</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> COMMENT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;支付核心单号（支付内部生成）&#39;,</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">biz_order_no</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> VARCHAR(64</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) NOT NULL COMMENT </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;业务方单号（业务方的核心单号）&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">channel_order_no</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> VARCHAR(64</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) DEFAULT NULL COMMENT </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;支付通道单号（第三方平台生成）&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    --</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 商户信息</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mch_no</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> VARCHAR(64</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) NOT NULL COMMENT </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;商户号（支付通道的商户号）&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isv_no</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> VARCHAR(64</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) DEFAULT NULL COMMENT </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;服务商号&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mch_type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TINYINT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEFAULT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> COMMENT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;商户类型：1-普通商户，2-特约商户（服务商模式）&#39;,</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    --</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 金额相关</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pay_amount</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> BIGINT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEFAULT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> COMMENT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;支付金额（单位：分）&#39;,</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">refund_amount</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> BIGINT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEFAULT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> COMMENT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;累计退款金额（单位：分）&#39;,</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">platform_subsidy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> BIGINT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEFAULT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> COMMENT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;平台补贴（单位：分）&#39;,</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">biz_subsidy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> BIGINT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEFAULT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> COMMENT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;业务方补贴（单位：分）&#39;,</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">channel_subsidy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> BIGINT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEFAULT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> COMMENT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;通道补贴（单位：分）&#39;,</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bank_subsidy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> BIGINT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEFAULT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> COMMENT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;银行补贴（单位：分）&#39;,</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    --</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 支付状态</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pay_status</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> VARCHAR(32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) DEFAULT NULL COMMENT </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;支付状态：待支付、支付成功、超时关单、主动关单等&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">refund_status</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TINYINT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEFAULT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> COMMENT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;退款状态：0-未退款，1-部分退款，2-全额退款&#39;,</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">refund_times</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> INT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEFAULT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> COMMENT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;退款次数&#39;,</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">callback_status</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TINYINT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEFAULT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> COMMENT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;向下游回调状态：0-未发送，1-已发送&#39;,</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    --</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 请求与结果</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">request_data</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TEXT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> COMMENT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;请求参数（下单时的原始JSON）&#39;,</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">result_data</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TEXT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> COMMENT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;支付结果（通道回调/主动查询结果JSON）&#39;,</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    --</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 支付方式与产品</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pay_type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> VARCHAR(32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) DEFAULT NULL COMMENT </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;支付方式（如 储蓄卡、信用卡、支付宝、微信、云闪付）&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">trade_type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> VARCHAR(32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) DEFAULT NULL COMMENT </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;支付产品（App支付、H5、小程序、扫码等）&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">receipt_channel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> VARCHAR(32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) DEFAULT NULL COMMENT </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;收单通道（如 京东、易宝、微信等）&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    --</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 业务信息</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">biz_line</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> VARCHAR(64</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) DEFAULT NULL COMMENT </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;业务线标识&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">biz_identity</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> VARCHAR(64</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) DEFAULT NULL COMMENT </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;业务标识&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    --</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 通知地址</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">notify_url</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> VARCHAR(255</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) DEFAULT NULL COMMENT </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;支付结果通知地址&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">return_url</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> VARCHAR(255</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) DEFAULT NULL COMMENT </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;页面跳转地址&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sign_notify_url</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> VARCHAR(255</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) DEFAULT NULL COMMENT </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;签约结果通知地址&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    --</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 用户信息</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">user_id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> VARCHAR(64</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) DEFAULT NULL COMMENT </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;内部用户ID&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">third_identity_id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> VARCHAR(128</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) DEFAULT NULL COMMENT </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;支付通道用户身份标识&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">client_ip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> VARCHAR(45</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) DEFAULT NULL COMMENT </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;客户端 IP&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    --</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 元数据</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">created_at</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> DATETIME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEFAULT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> CURRENT_TIMESTAMP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> COMMENT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;创建时间&#39;,</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">updated_at</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> DATETIME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEFAULT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> CURRENT_TIMESTAMP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ON</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> UPDATE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> CURRENT_TIMESTAMP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> COMMENT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;更新时间&#39;,</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    PRIMARY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> KEY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    UNIQUE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> KEY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">uniq_pay_order_no</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pay_order_no</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT=&#39;支付订单主表&#39;;</span></span></code></pre></div><h2 id="支付路由表核心字段" tabindex="-1">支付路由表核心字段 <a class="header-anchor" href="#支付路由表核心字段" aria-label="Permalink to &quot;支付路由表核心字段&quot;">​</a></h2><p>TODO</p><h3 id="收单场景及规则" tabindex="-1">收单场景及规则 <a class="header-anchor" href="#收单场景及规则" aria-label="Permalink to &quot;收单场景及规则&quot;">​</a></h3><div class="language-markdown vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">markdown</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-- 收单场景</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">id</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">场景编码：varchar</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">场景名称：描述这是用作什么场景收单的规则</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">场景状态：int 下线，上线</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">匹配策略：varchar 类名，入参为mapParam，出参为true/false。策略内会限制是全量mapParam做匹配，还是部分mapParam做匹配。</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    宽松匹配，满足条件即可，即参数有 A B C D，对于场景规则 A B，A C D，A B C D 均可匹配成功。</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    严格匹配，严格按照策略内规定好的参数，进行匹配。</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">规则脚本：varchar script_code</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">备注：</span></span></code></pre></div><h3 id="规则路由表" tabindex="-1">规则路由表 <a class="header-anchor" href="#规则路由表" aria-label="Permalink to &quot;规则路由表&quot;">​</a></h3><p>id 场景编码：varchar 支付方式：varchar 储蓄卡、信用卡、支付宝、微信、云闪付 支付产品：varchar App H5 小程序 扫码 协议支付(快捷支付) 周期支付 商户代扣 收单通道：varchar 易宝、通联、招商银行、支付宝、微信 收单策略：varchar 服务商商户号：varchar 商户号：varchar 通道权重：int 通道状态：int 下线，上线，暂停使用 生效时间：datetime 最近一次已生效或待生效的时间 备注：varchar</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">CREATE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> TABLE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rule_route</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> BIGINT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> UNSIGNED</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> NOT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> NULL</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> AUTO_INCREMENT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> COMMENT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;主键 ID&#39;,</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">scene_code</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> VARCHAR(64</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NOT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> NULL</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> COMMENT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;场景编码&#39;,</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pay_method</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> VARCHAR(32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) NOT NULL COMMENT </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;支付方式（储蓄卡、信用卡、支付宝、微信、云闪付）&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pay_product</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> VARCHAR(32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) NOT NULL COMMENT </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;支付产品（App、H5、小程序、扫码、协议支付、周期支付、商户代扣）&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">acquire_channel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> VARCHAR(32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) NOT NULL COMMENT </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;收单通道（易宝、通联、招商银行、支付宝、微信）&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">acquire_strategy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> VARCHAR(64</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) DEFAULT NULL COMMENT </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;收单策略&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">provider_merchant_no</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> VARCHAR(64</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) DEFAULT NULL COMMENT </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;服务商商户号&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">merchant_no</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> VARCHAR(64</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) DEFAULT NULL COMMENT </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;商户号&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">channel_weight</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> INT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEFAULT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> COMMENT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;通道权重&#39;,</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">channel_status</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TINYINT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEFAULT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> COMMENT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;通道状态（0-下线，1-上线，2-暂停使用）&#39;,</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">effective_time</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> DATETIME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEFAULT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> NULL</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> COMMENT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;生效时间（最近一次已生效或待生效的时间）&#39;,</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">remark</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> VARCHAR(255</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) DEFAULT NULL COMMENT </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;备注&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">create_time</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> DATETIME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEFAULT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> CURRENT_TIMESTAMP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> COMMENT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;创建时间&#39;,</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">update_time</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> DATETIME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEFAULT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> CURRENT_TIMESTAMP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ON</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> UPDATE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> CURRENT_TIMESTAMP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> COMMENT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;更新时间&#39;,</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">PRIMARY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> KEY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">KEY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">idx_rule_code</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rule_code</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">,</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">KEY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">idx_channel_flag</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">channel_flag</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT=&#39;规则路由表&#39;;</span></span></code></pre></div><h2 id="支付与业务方的对接模式有哪些" tabindex="-1">支付与业务方的对接模式有哪些 <a class="header-anchor" href="#支付与业务方的对接模式有哪些" aria-label="Permalink to &quot;支付与业务方的对接模式有哪些&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>对接渠道的模式</span></span>\n<span class="line"><span>渠道收款 - 外借商户号/渠道预付费</span></span>\n<span class="line"><span>    支付结果由渠道通知，也可主动查询</span></span>\n<span class="line"><span>    退款由渠道/客服系统发起</span></span>\n<span class="line"><span>    退款驳回</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>自收款，渠道微信小程序</span></span>\n<span class="line"><span>    收单类 ChWechatMiniPayService，返回appid + mini跳转参数(path,callback=channelPayParam)，前端跳转微信小程序。 (pages/webview/thirdpay/index?paySn=支付单号&amp;path=payAggregation/channelPayParam&amp;pft=10066001&amp;orderNo=订单号)</span></span>\n<span class="line"><span>    收银台 无，默认微信小程序</span></span>\n<span class="line"><span>    通道下单 /channelPayParam，直连间连均返回TradeNo这种参数。</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>自收款，渠道App+H5收银台(无登录状态) 骑士卡api、快电、中移上研流程</span></span>\n<span class="line"><span>    收单类 QishikaApiPayService；返回跳转收银台的连接</span></span>\n<span class="line"><span>    收银台 h5PayInfoForBizChannel；依赖渠道号，查开放平台支付方式，根据映射关系找到我方PayTypeInfoConfig实际支付方式</span></span>\n<span class="line"><span>    通道下单 h5ObtainPayInfoForBizChannel；二代路由。</span></span>\n<span class="line"><span>        直连：返回标准参数</span></span>\n<span class="line"><span>        间连：</span></span>\n<span class="line"><span>            App 微信返回跳转小程序参数(pages/webview/payapp/index?paySn=支付单号&amp;path=payAggregation/obtainWeChatMiniPayInfo&amp;pft=10066001&amp;orderNo=订单号) appWeChatMiniPaymentService</span></span>\n<span class="line"><span>                支付宝返回scheme zfbIndirectPaymentService</span></span>\n<span class="line"><span>            H5  微信返回scheme，包装obtainWeChatMiniPayInfo接口 h5WeChatMiniPaymentService </span></span>\n<span class="line"><span>                支付宝返回scheme，包装obtainZfbMiniPayParams接口 zfbIndirectPaymentService</span></span>\n<span class="line"><span>            Mini/MP</span></span>\n<span class="line"><span>                支付宝/微信都返回appid、paySign，前端分别在微信/支付宝里打开对应的小程序。 AdaPaymentService YeePaymentService</span></span>\n<span class="line"><span>        </span></span>\n<span class="line"><span>        返回scheme的还需再一次请求通道下单 obtainWeChatMiniPayInfo / obtainZfbMiniPayParams</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>渠道App+独立支付参数</span></span>\n<span class="line"><span>    下空单 </span></span>\n<span class="line"><span>    支付参数获取 PayParamApi</span></span></code></pre></div>',25)]))}const y=i(k,[["render",t]]);export{E as __pageData,y as default};

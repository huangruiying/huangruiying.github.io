<!DOCTYPE html>
<html lang="zh">
    <head>
        
        


<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="chrome=1">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer">
<meta name="description" content="站点描述">
<title>
Docker教程 基础的安装与使用 - 博客
</title>



        
        <meta property="og:title" content="Docker教程 - 基础的安装与使用 - 博客" />
<meta property="og:type" content="website" />
<meta property="og:description" content="Docker快速使用"/>
<meta property="og:url" content="https://huangruiying.github.io/%E5%BC%80%E6%BA%90%E8%BD%AF%E4%BB%B6/docker-%E6%9C%8D%E5%8A%A1%E5%AE%B9%E5%99%A8/docker%E6%95%99%E7%A8%8B-%E5%9F%BA%E7%A1%80%E7%9A%84%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8/"/>
<meta property="og:site_name" content="博客"/>




<meta property="og:image" content="https://huangruiying.github.io/home/profile.jpg"/>




        
<link rel="shortcut icon" href="/img/fav.ico">


        





<link rel="stylesheet" href="/css/main.min.dd3261b90e17cd2e5208587affc019817808ed59c99ecc51d4593170ce72c29d.css" integrity="sha256-3TJhuQ4XzS5SCFh6/8AZgXgI7VnJnsxR1FkxcM5ywp0=" crossorigin="anonymous" media="screen">





        
        
        
        
    </head>
    <body>
        <section id="top" class="section">
            
            <div class="container hero  fade-in one ">
                
                <h1 class="bold-title is-1">Docker教程 - 基础的安装与使用</h1>
                
            </div>
            
            <div class="section  fade-in two ">
                

<div class="container">
    <hr>
    <nav class="navbar" role="navigation" aria-label="main navigation">
        
        <a role="button" class="navbar-burger" data-target="navMenu" aria-label="menu" aria-expanded="false" >
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
        </a>
        <div class="navbar-menu " id="navMenu">
            
            
            
            
            <a class="navbar-item" href="/blog/">
                
                博客
                
            </a>
            
            
            
            <a class="navbar-item" href="/tags/">
                
                标签
                
            </a>
            
            
            
            <a class="navbar-item" href="/categories/">
                
                类目
                
            </a>
            
            
            
            <a class="navbar-item" href="/">
                
                主页
                
            </a>
            
            
            
        </div>
    </nav>
    <hr>
</div>




                
    <div class="container markdown top-pad">
        
<h1 id="1安装docker" class="anchor-link"><a href="#1%e5%ae%89%e8%a3%85docker">1.安装docker</a></h1>

<h4 id="安装" class="anchor-link"><a href="#%e5%ae%89%e8%a3%85">安装</a></h4>
<p>yum install docker-io -y</p>

<h4 id="查看版本" class="anchor-link"><a href="#%e6%9f%a5%e7%9c%8b%e7%89%88%e6%9c%ac">查看版本</a></h4>
<p>docker -v</p>

<h4 id="启动" class="anchor-link"><a href="#%e5%90%af%e5%8a%a8">启动</a></h4>
<p>service docker start</p>

<h4 id="设置开机启动" class="anchor-link"><a href="#%e8%ae%be%e7%bd%ae%e5%bc%80%e6%9c%ba%e5%90%af%e5%8a%a8">设置开机启动</a></h4>
<p>chkconfig docker on</p>

<h1 id="2配置docker" class="anchor-link"><a href="#2%e9%85%8d%e7%bd%aedocker">2.配置docker</a></h1>
<blockquote>
<p>因为国内访问 Docker Hub 较慢, 可以使用腾讯云提供的国内镜像源, 加速访问 Docker Hub</p>
</blockquote>

<h4 id="设置docker库" class="anchor-link"><a href="#%e8%ae%be%e7%bd%aedocker%e5%ba%93">设置docker库</a></h4>
<pre tabindex="0"><code>echo &#34;OPTIONS=&#39;--registry-mirror=https://mirror.ccs.tencentyun.com&#39;&#34; &gt;&gt; /etc/sysconfig/docker
systemctl daemon-reload
service docker restart
</code></pre>
<h1 id="3docker实操" class="anchor-link"><a href="#3docker%e5%ae%9e%e6%93%8d">3.docker实操</a></h1>

<h4 id="下载镜像" class="anchor-link"><a href="#%e4%b8%8b%e8%bd%bd%e9%95%9c%e5%83%8f">下载镜像</a></h4>
<p><code>docker pull centos</code></p>

<h4 id="查看当前镜像列表--解释列信息" class="anchor-link"><a href="#%e6%9f%a5%e7%9c%8b%e5%bd%93%e5%89%8d%e9%95%9c%e5%83%8f%e5%88%97%e8%a1%a8--%e8%a7%a3%e9%87%8a%e5%88%97%e4%bf%a1%e6%81%af">查看当前镜像列表  （解释列信息）</a></h4>
<p><code>docker images</code></p>
<table>
<thead>
<tr>
<th>REPOSITORY</th>
<th>TAG</th>
<th>IMAGE ID</th>
<th>CREATED</th>
<th>SIZE</th>
</tr>
</thead>
<tbody>
<tr>
<td>REPOSITORY</td>
<td>TAG</td>
<td>IMAGE ID</td>
<td>CREATED</td>
<td>SIZE</td>
</tr>
<tr>
<td>docker.io/centos</td>
<td>latest</td>
<td>75835a67d134</td>
<td>6 weeks ago</td>
<td>200 MB</td>
</tr>
<tr>
<td>拓展：</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>docker images --format &quot;table {{.ID}}\t{{.Repository}}\t{{.Size}}&quot;</code> 显示指定列</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

<h4 id="运行容器" class="anchor-link"><a href="#%e8%bf%90%e8%a1%8c%e5%ae%b9%e5%99%a8">运行容器</a></h4>
<blockquote>
<p>1.标准模式<br>
<code>docker run -it centos /bin/bash</code><br>
docker run &lt; 相关命令 &gt;  &lt; 镜像名称 | 镜像ID[IMAGE_ID] | 仓库名:标签名[REPOSITORY:TAG] &gt;  &lt; 初始命令 &gt;<br>
-i      允许有命令交互<br>
-t      在新容器内指定一个伪终端<br>
/bin/bash初始命令<br>
2.后台模式<br>
<code>docker run -d centos /bin/sh -c &quot;while true; do echo hello world; sleep 1; done&quot;</code><br>
065354682b055e773ecb2c7482a8526c2b7d2b54c2ac0f69d40291a8989aab64<br>
-d      后台运行<br>
3.挂载目录
<code>docker run -i -t -v /root/software/:/mnt/software/ 25c5298b1a36 /bin/bash</code><br>
-v      挂载目录 -v &lt; 宿主机目录 &gt;:&lt; 容器目录 &gt;<br>
4.查看日志<br>
<code>docker logs 065354682b055e773ecb2c7482a8526c2b7d2b54c2ac0f69d40291a8989aab64</code><br>
docker日志输出到指定文件
<code> </code></p>
</blockquote>

<h4 id="停止容器" class="anchor-link"><a href="#%e5%81%9c%e6%ad%a2%e5%ae%b9%e5%99%a8">停止容器</a></h4>
<blockquote>
<p><code>docker stop [ 启动容器返回的key | 容器ID ]</code><br>
<code>docker stop 065354682b055e773ecb2c7482a8526c2b7d2b54c2ac0f69d40291a8989aab64</code></p>
</blockquote>

<h4 id="查看容器" class="anchor-link"><a href="#%e6%9f%a5%e7%9c%8b%e5%ae%b9%e5%99%a8">查看容器</a></h4>
<ol>
<li>查看当前运行的容器
<code>docker ps</code>
<table>
<thead>
<tr>
<th>CONTAINER ID</th>
<th>IMAGE</th>
<th>COMMAND</th>
<th>CREATED</th>
<th>STATUS</th>
<th>PORTS</th>
<th>NAMES</th>
</tr>
</thead>
<tbody>
<tr>
<td>CONTAINER ID</td>
<td>IMAGE</td>
<td>COMMAND</td>
<td>CREATED</td>
<td>STATUS</td>
<td>PORTS</td>
<td>NAMES</td>
</tr>
<tr>
<td>9b90b23597d2</td>
<td>centos</td>
<td>&ldquo;/bin/bash&rdquo;</td>
<td>About a minute ago</td>
<td>Exited (0) 56 seconds ago</td>
<td></td>
<td>epic_perlman</td>
</tr>
</tbody>
</table>
</li>
<li>查看历史运行过的容器
<code>docker ps -a</code></li>
</ol>

<h4 id="删除历史运行过的容器信息" class="anchor-link"><a href="#%e5%88%a0%e9%99%a4%e5%8e%86%e5%8f%b2%e8%bf%90%e8%a1%8c%e8%bf%87%e7%9a%84%e5%ae%b9%e5%99%a8%e4%bf%a1%e6%81%af">删除历史运行过的容器信息</a></h4>
<blockquote>
<p>&ndash;杀死所有正在运行的容器<br>
docker kill $(docker ps -a -q)<br>
&ndash;删除所有已经停止的容器<br>
docker rm $(docker ps -a -q)<br>
&ndash;删除所有未打 dangling 标签的镜像<br>
docker rmi $(docker images -q -f dangling=true)<br>
&ndash;删除所有镜像<br>
docker rmi $(docker images -q)<br>
&ndash;强制删除镜像名称中包含“doss-api”的镜像<br>
docker rmi &ndash;force $(docker images | grep doss-api | awk &lsquo;{print $3}&rsquo;)<br>
&ndash;删除所有未使用数据<br>
docker system prune<br>
&ndash;只删除未使用的volumes<br>
docker volume prune</p>
</blockquote>

<h4 id="提交docker" class="anchor-link"><a href="#%e6%8f%90%e4%ba%a4docker">提交docker</a></h4>
<p><code>docker commit -m=&quot;提交信息&quot; [imageid] [dockername]</code></p>

<h4 id="打tagrepositorytag是自己定义的" class="anchor-link"><a href="#%e6%89%93tagrepositorytag%e6%98%af%e8%87%aa%e5%b7%b1%e5%ae%9a%e4%b9%89%e7%9a%84">打tag,repository:tag是自己定义的</a></h4>
<p><code>docker tag [imageid] [repository]:[tag] </code></p>

<h4 id="删除tag" class="anchor-link"><a href="#%e5%88%a0%e9%99%a4tag">删除tag</a></h4>
<p><code>docker rmi [repository]:[tag]</code></p>

<h4 id="删除容器历史docker-ps--a内数据" class="anchor-link"><a href="#%e5%88%a0%e9%99%a4%e5%ae%b9%e5%99%a8%e5%8e%86%e5%8f%b2docker-ps--a%e5%86%85%e6%95%b0%e6%8d%ae">删除容器历史docker ps -a内数据</a></h4>
<p><code>docker rm [container]</code></p>

<h4 id="保存docker到img文件" class="anchor-link"><a href="#%e4%bf%9d%e5%ad%98docker%e5%88%b0img%e6%96%87%e4%bb%b6">保存docker到img文件</a></h4>
<p><code>docker save [] &gt; xxx.imgs</code></p>

<h4 id="加载img文件" class="anchor-link"><a href="#%e5%8a%a0%e8%bd%bdimg%e6%96%87%e4%bb%b6">加载img文件</a></h4>
<p><code>docker load xxx.img</code></p>

<h4 id="删除某镜像" class="anchor-link"><a href="#%e5%88%a0%e9%99%a4%e6%9f%90%e9%95%9c%e5%83%8f">删除某镜像</a></h4>
<p><code>docker rmi -f IMAGE huang/testimport:v1</code><br>
docker rmi &lt; 相关命令 &gt; IMAGE &lt; REPOSITORY:TAR &gt;
-f      强制删除</p>

<h4 id="限制内存使用上限" class="anchor-link"><a href="#%e9%99%90%e5%88%b6%e5%86%85%e5%ad%98%e4%bd%bf%e7%94%a8%e4%b8%8a%e9%99%90">限制内存使用上限</a></h4>
<p><code>docker run .....  -m 300M --memory-swap=500M ...</code>
注：&ndash;memory-swap 是 memory 与 swap 之和。</p>

<h4 id="查看容器内存占用" class="anchor-link"><a href="#%e6%9f%a5%e7%9c%8b%e5%ae%b9%e5%99%a8%e5%86%85%e5%ad%98%e5%8d%a0%e7%94%a8">查看容器内存占用</a></h4>
<p><code>docker stats</code></p>

<h4 id="日志查看" class="anchor-link"><a href="#%e6%97%a5%e5%bf%97%e6%9f%a5%e7%9c%8b">日志查看</a></h4>
<p><code>docker logs -f xxxxxx</code></p>

<h1 id="4进入后台运行的docker的四种方式httpswwwcnblogscomxhyanp6593075html" class="anchor-link"><a href="#4%e8%bf%9b%e5%85%a5%e5%90%8e%e5%8f%b0%e8%bf%90%e8%a1%8c%e7%9a%84docker%e7%9a%84%e5%9b%9b%e7%a7%8d%e6%96%b9%e5%bc%8fhttpswwwcnblogscomxhyanp6593075html">4.<a href="https://www.cnblogs.com/xhyan/p/6593075.html">进入后台运行的Docker的四种方式</a></a></h1>
<p><code>docker exec -it [ CONTAINER | 775c7c9ee1e1 ] /bin/bash</code><br>
docker exec &lt; 相关命令 &gt;  &lt; 当前运行的容器CONTAINER | 启动容器时返回的Key &gt;  &lt;初始命令&gt;</p>

<h1 id="5宿主机与docker交互" class="anchor-link"><a href="#5%e5%ae%bf%e4%b8%bb%e6%9c%ba%e4%b8%8edocker%e4%ba%a4%e4%ba%92">5.宿主机与Docker交互</a></h1>

<h4 id="从宿主机拷文件到容器里面" class="anchor-link"><a href="#%e4%bb%8e%e5%ae%bf%e4%b8%bb%e6%9c%ba%e6%8b%b7%e6%96%87%e4%bb%b6%e5%88%b0%e5%ae%b9%e5%99%a8%e9%87%8c%e9%9d%a2">从宿主机拷文件到容器里面</a></h4>
<p><code>docker cp jdk-7u55-linux-i586.tar.gz high_saha:/opt</code><br>
docker cp &lt;文件&gt; &lt;&gt;:&lt; 容器目录 &gt;</p>

<h4 id="自动编译etcsource" class="anchor-link"><a href="#%e8%87%aa%e5%8a%a8%e7%bc%96%e8%af%91etcsource">自动编译/etc/source</a></h4>
<p>在~/.bashrc内</p>
<pre tabindex="0"><code>source /etc/profile
</code></pre>
<h1 id="6容器的导入导出加载保存" class="anchor-link"><a href="#6%e5%ae%b9%e5%99%a8%e7%9a%84%e5%af%bc%e5%85%a5%e5%af%bc%e5%87%ba%e5%8a%a0%e8%bd%bd%e4%bf%9d%e5%ad%98">6.容器的导入导出,加载保存</a></h1>

<h4 id="1根据容器id创建镜像" class="anchor-link"><a href="#1%e6%a0%b9%e6%8d%ae%e5%ae%b9%e5%99%a8id%e5%88%9b%e5%bb%ba%e9%95%9c%e5%83%8f">1.根据容器ID创建镜像</a></h4>
<p><code>docker commit 75c6825032ee hry/testcrt:v2</code><br>
容器ID可以在docker ps -a获取到[CONTAINER ID]
docker import [tar文件] &lt; REPOSITORY:TAR&gt;</p>

<h4 id="2保存容器" class="anchor-link"><a href="#2%e4%bf%9d%e5%ad%98%e5%ae%b9%e5%99%a8">2.保存容器</a></h4>
<p><code>docker save -o /java_docker-io_centos__java_use-save.tar docker.io/centos:java</code></p>

<h4 id="3加载容器" class="anchor-link"><a href="#3%e5%8a%a0%e8%bd%bd%e5%ae%b9%e5%99%a8">3.加载容器</a></h4>
<p><code>docker load &lt; /java_docker-io_centos__java_use-save.tar</code></p>
<pre tabindex="0"><code>#自动配置环境变量脚本
#!/bin/bash
## java env

JAVA_JDK_PATH=$1
JAVA_JDK_NAME=$2
profile_path=$3

if [[ `grep -c &#34;JAVA_HOME&#34; /etc/profile` -eq &#39;0&#39; ]]; then
  echo &#39;java env already config&#39;
  exit -1
fi

if [[ &#34;$JAVA_JDK_PATH&#34; == &#39;&#39; ]]; then
  JAVA_JDK_PATH=/usr/local/bin
fi

if [[ &#34;$JAVA_JDK_NAME&#34; == &#39;&#39; ]]; then
  JAVA_JDK_NAME=jdk
fi

if [[ &#34;$profile_path&#34; == &#39;&#39; ]]; then
  profile_path=/etc
fi

## if(java_jdk_path.lastIndexOf(/) == java_jdk_path.length()-1)
if [[ &#34;$JAVA_JDK_PATH&#34; =~ /$ ]]; then
  JAVA_JDK_PATH=${JAVA_JDK_PATH%/*}
fi

## if(java_jdk_name.lastIndexOf(/) == java_jdk_name.length()-1)
if [[ &#34;$JAVA_JDK_NAME&#34; =~ /$ ]]; then
  JAVA_JDK_NAME=${JAVA_JDK_NAME%/*}
fi

echo &#39;export JAVA_HOME=&#39;$JAVA_JDK_PATH&#39;/&#39;$JAVA_JDK_NAME&#39;/&#39; &gt;&gt; $profile_path/profile;
echo &#39;export PATH=$JAVA_HOME/bin:$PATH&#39; &gt;&gt; $profile_path/profile;
echo &#39;export CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar&#39; &gt;&gt; $profile_path/profile;
</code></pre>
<h3 id="docker部署程序" class="anchor-link"><a href="#docker%e9%83%a8%e7%bd%b2%e7%a8%8b%e5%ba%8f">Docker部署程序</a></h3>
<pre tabindex="0"><code>## dockerfile
## 定义使用哪个基础镜像
FROM docker.io/centos:java2

## 作者信息
MAINTAINER huangruiying

## COPY /resources/path/xxx.jar 
COPY regin-tools.jar /app.jar

## 运行
CMD java -jar /app.jar

## 设置对外端口
EXPOSE 8088
</code></pre>
<h5 id="使用dockerfile生成当前项目的新的镜像-表示在当前目录寻找dckerfile" class="anchor-link"><a href="#%e4%bd%bf%e7%94%a8dockerfile%e7%94%9f%e6%88%90%e5%bd%93%e5%89%8d%e9%a1%b9%e7%9b%ae%e7%9a%84%e6%96%b0%e7%9a%84%e9%95%9c%e5%83%8f-%e8%a1%a8%e7%a4%ba%e5%9c%a8%e5%bd%93%e5%89%8d%e7%9b%ae%e5%bd%95%e5%af%bb%e6%89%bedckerfile">使用dockerfile生成当前项目的新的镜像,&quot;.&quot; 表示在当前目录寻找dckerfile</a></h5>
<p><code>docker build -t [REPOSITORY:TAG] .</code></p>

<h5 id="启动项目" class="anchor-link"><a href="#%e5%90%af%e5%8a%a8%e9%a1%b9%e7%9b%ae">启动项目</a></h5>
<p><code>docker run -p 8088:8088 -d --name regin-tools java_regin-tools:latest</code><br>
docker run &lt;-p [宿主机端口]:[容器端口]&gt; &lt;-d 表示后台启动&gt; &lt;&ndash;name [启动的容器别名]&gt; REPOSITORY:TAG</p>
<blockquote>
<p>问题</p>
</blockquote>
<ol>
<li>WARNING: IPv4 forwarding is disabled. Networking will not work.</li>
</ol>
<pre tabindex="0"><code># 宿主机运行：
vim  /usr/lib/sysctl.d/00-system.conf
# 在文件内添加
net.ipv4.ip_forward=1
# 重启服务
systemctl restart network
systemctl restart docker
</code></pre><ol start="2">
<li>/usr/bin/docker-current: Error response from daemon: oci runtime error: container_linux.go:247: starting container process caused &ldquo;exec: &quot;java&quot;: executable file not found in $PATH&rdquo;.</li>
</ol>
<pre tabindex="0"><code># 在docker镜像内添加软链到/usr/bin
ln -s /your/javahome/bin/java /usr/bin/
# 再重新生成下镜像
</code></pre>
    </div>
    
    



                
                <div class="container">
    <hr>
</div>
<div class="container has-text-centered top-pad">
    <a href="#top">
        <i class="fa fa-arrow-up"></i>
    </a>
</div>

<div class="container">
    <hr>
</div>

                <div class="section" id="footer">
    <div class="container has-text-centered">
    
        <span class="footer-text">
            
        </span>
    
    </div>
</div>

                
            </div>
        </section>
        
        


<script src="https://huangruiying.github.io/js/bundle.5c23c0437f001a469ca373a465a6f7487203d18e10cdff76d86a60af66d5ee28.js" integrity="sha256-XCPAQ38AGkaco3OkZab3SHID0Y4Qzf922Gpgr2bV7ig="></script>




        
        
        
        
    </body>
</html>
